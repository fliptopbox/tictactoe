(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{18:function(e,t,a){e.exports=a(29)},23:function(e,t,a){},24:function(e,t,a){},28:function(e,t,a){},29:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),i=a(17),o=a.n(i),s=(a(23),a(24),a(3)),c=a(6),l=a(7),u=a(10),d=a(8),h=a(4),m=a(9),f=a(0),v=function(e){function t(e){var a,n=e.sceneDidMount,r=e.engineOptions,i=e.adaptToDeviceRatio;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this))).onResizeWindow=function(){var e=Object(h.a)(a).engine;e&&e.resize()},a.onCanvasLoaded=function(e){e&&(a.canvas=e)},a.scene=null,a.engine=null,a.canvas=null,a.sceneDidMount=n,a.engineOptions=r,a.adaptToDeviceRatio=i,a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.scene;var e=this.sceneDidMount,t=this.canvas,a=this.engine,n=this.engineOptions,r=this.adaptToDeviceRatio;if("function"!==typeof e)return console.error("sceneDidMount function not available"),null;a=new f.Engine(t,!0,n,r),e({scene:new f.Scene(a),engine:a,canvas:t}),window.addEventListener("resize",this.onResizeWindow)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResizeWindow)}},{key:"render",value:function(){var e=Object(s.a)({},this.props.opts);return r.a.createElement("canvas",Object.assign({id:"renderCanvas"},e,{ref:this.onCanvasLoaded,"touch-action":"none"}))}}]),t}(n.Component),p=a(2),y=a(12),g=a.n(y);function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=Math.random()*(e-t)+t;return a||1!==e||0!==t||(n=Math.round(n)),a?n:n>>0}function w(e,t){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60,n=a*(e/1e3),r=1e3/a,i=function(e){setTimeout((function(){return t?t(Number(e/n),e):null}),e*r)},o=0;o<=n;o+=1)i(o)}var E=0;var O=a(5),x=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return null;var a=t?255:1,n=(e=(e=(e=e.replace(/^0x+/,"")).replace(/[^0-9a-f]+/gi,"")).toLowerCase()).length<6?e.split(/([0-9a-f]{1})/i):e.split(/([0-9a-f]{2})/i);return n=(n=n.filter((function(e){return e.length}))).map((function(e){return e.length-1?"0x".concat(e):"0x".concat(e).concat(e)})).map((function(e){return Number(e)/a})).slice(0,3)};var C={core:{diffuseColor:"#ff0000",emissiveColor:"#550000",ambientColor:"#000000",visibility:.3,wireframe:!0},ground:{diffuseColor:"#222222"},solid:{diffuseColor:new f.Color3(1,0,1)},wire:{diffuseColor:new f.Color3(1,0,1),wireframe:!0},red:{diffuseColor:"#ee0000",ambientColor:"#000011",emissiveColor:"#111111",textColor:"#000000",wireframe:!1},black:{diffuseColor:"#121212",emissiveColor:"#000000",textColor:"#ffffff",wireframe:!1},white:{diffuseColor:"#dfdfdf",textColor:"#000000",wireframe:!1},grey:{diffuseColor:"#7c7c7c",textColor:"#000000",wireframe:!1},surface:{diffuseColor:new f.Color3(0,0,0),emissiveColor:new f.Color3(0,0,0),wireframe:!0}},N=function(e){var t=e.scene;return function(e,a){if(!C[e])return null;var n=new f.StandardMaterial(e,t),r=C[e],i=/white/i.test(e)?"black":"white";if(a){console.log("dyn",a);var o=new f.DynamicTexture("dtex",{width:150,height:150},t,!0);n.diffuseTexture=o,o.drawText(a,10,40,"bold 20px Arial",i,r.diffuseColor,!0,!0),n.diffuseTexture.uOffset=0,n.diffuseTexture.vOffset=0}return Object.keys(r).forEach((function(e){var t=r[e],i=/^#[0-9a-f]{3,6}$/i.test(t||"")?x(t):null,o=i||[],s=Object(O.a)(o,3),c=s[0],l=s[1],u=s[2];"diffuseColor"===e&&(n.hexColor=t),t=i?new f.Color3(c,l,u):t,"diffuseColor"===e&&a||(n[e]=t)})),n}};var k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"alpha",n=null,r=t/1e3;return a=(a=/^(alpha|beta)$/i.test(a)?a:"alpha").toLowerCase(),function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return void 0===i||null===i?null!==n:0===i?(clearTimeout(n),void(n=null)):(e[a]+=r*i,void(n=setTimeout((function(){return t(i)}),50)))}};var M=function(e,t){var a=e.scene,n=e.canvas,r=1.2*t.state.radius,i=new f.ArcRotateCamera("Camera",.45539,4.164,r,null,a);i.fov=1.2,i.setTarget(new f.Vector3(0,-1,0));var o=k(i);return o(1),window.camera={camera:i,start:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;o()&&o(0),t.setState({showIntro:!1}),j(i,e,t.state.radius),i.attachControl(n,!0)},orbit:o,attach:i.attachControl(n,!0)},i};function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,a=(arguments.length>2?arguments[2]:void 0)+2,n=a+a/2,r=e.alpha,i=e.beta,o=e.radius,s=e.fov,c=1,l=7.2,u=n,d=1.5;w(1.05*t,(function(t){e.beta=i+t*(c-i),e.alpha=r+t*(l-r)})),w(t,(function(t){e.radius=o+t*(u-o),e.fov=s+t*(d-s)}))}var P=a(14),S=function(e){var t,a=e.scene,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hemi",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"light",i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[.5,.5,.5],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[.5,.5,.5],c=Object(P.a)(f.Vector3,Object(p.a)(o));switch(n){case"hemi":(t=new f.HemisphericLight(r,c,a)).groundColor=Object(P.a)(f.Color3,Object(p.a)(s));break;case"point":default:t=new f.PointLight(r,c,a)}return t.intensity=i,t};for(var T=a(13),D=[],I=[],V=[],A=65;A>=25;A-=5){var z,L,R;z="#"+T.hsl.hex(120,45,A),L="#"+T.hsl.hex(204,60,A),R="#"+T.hsl.hex(12,40,A),D.push(x(z)),I.push(x(L)),V.push(x(R)),console.log("%c GREEN %c TEAL %c BROWN","background: ".concat(z),"background: ".concat(L),"background: ".concat(R),A,z,L,R,A-25)}function B(e,t){var a=t.scene,n=e.type,r=e.axis,i=e.mesh,o=e.id,s=[e.x,e.y,e.z].join(","),c=("".concat(o,"(").concat(s,")").concat(r?"#":""),function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0===e)return V[Math.random()*V.length>>0];var a=[].concat(Object(p.a)(D.slice(0,-2)),Object(p.a)(I.slice(0,-2))),n=[].concat(Object(p.a)(D.slice(-2)),Object(p.a)(I.slice(-2))),r=t?n:a;return r[Math.random()*r.length>>0]}(n,r)),l=Object(O.a)(c,3),u=l[0],d=l[1],h=l[2],m=new f.Color3(u,d,h).toHexString(),v=new f.StandardMaterial(o,a);return v.diffuseColor=new f.Color3(u,d,h),v.wireframe=!1,i.material=v,i.id="m"+o,i.material.hexColor=m,e}var H=3,J=2,F=1,W=0;var G=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)+2,t=e,a=Math.pow(t,2),n=Math.pow(t,3),r=(e-1)/2;return{matrix:Object(p.a)(Array(n)).map((function(e,n){var i=n%t,o=(n/t>>0)%t,s=(n/a>>0)%t,c=function(e,t,a,n){var r=Math.abs(t)<e&&Math.abs(a)<e&&Math.abs(n)<e,i=Math.abs(t),o=Math.abs(a),s=Math.abs(n),c=0;return c=(c=(c=(c=(c=Number(i+o+s)===e*H?H:0)||Number(i+o)===e*H-e&&J)||Number(i+s)===e*H-e&&J)||Number(o+s)===e*H-e&&J)||F,{type:c=r?W:c,axis:(0===i||0===o||0===s)&&(0===i&&0===o&&s===e||0===o&&0===s&&i===e||0===s&&0===i&&o===e)}}(r,i+=-r,o+=-r,s+=-r),l=c.axis;return{id:n,x:i,y:o,z:s,type:c.type,axis:l,owner:0}})),metadata:{columns:t,offset:r}}};var K=function(e){var t=e.scene,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=f.MeshBuilder.CreateBox,r=t.meshes;r.filter((function(e){return e&&e.id&&/^m[0-9]+$/.test(e.id)})).forEach((function(e){return e.dispose()}));var i=G(a).matrix.map((function(e){var a=e.id,r=e.x,i=e.y,o=e.z,c=e.type,l=n(a,{size:c?.85:.68},t);return l.position=new f.Vector3(r,i,o),l.id="m"+a,l.isCore=0===c,Object(s.a)({},e,{mesh:l})}));return i.filter((function(e){return!e.core})).forEach((function(e){return B(e,{scene:t})})),i};var Y=function(e,t){if(!(arguments.length>2&&void 0!==arguments[2]&&arguments[2]))return;f.Mesh.CreateLines("axisX",[new f.Vector3.Zero,new f.Vector3(e,0,0),new f.Vector3(.95*e,.05*e,0),new f.Vector3(e,0,0),new f.Vector3(.95*e,-.05*e,0)],t).color=new f.Color3(1,0,0),U(t,"X","red",e/10).position=new f.Vector3(.9*e,-.05*e,0),f.Mesh.CreateLines("axisY",[new f.Vector3.Zero,new f.Vector3(0,e,0),new f.Vector3(-.05*e,.95*e,0),new f.Vector3(0,e,0),new f.Vector3(.05*e,.95*e,0)],t).color=new f.Color3(0,1,0),U(t,"Y","green",e/10).position=new f.Vector3(0,.9*e,-.05*e),f.Mesh.CreateLines("axisZ",[new f.Vector3.Zero,new f.Vector3(0,0,e),new f.Vector3(0,-.05*e,.95*e),new f.Vector3(0,0,e),new f.Vector3(0,.05*e,.95*e)],t).color=new f.Color3(0,0,1),U(t,"Z","blue",e/10).position=new f.Vector3(0,.05*e,.9*e)};function U(e,t,a,n){var r=new f.DynamicTexture("DynamicTexture",50,e,!0);r.hasAlpha=!0,r.drawText(t,5,40,"bold 36px Arial",a,"transparent",!0);var i=new f.Mesh.CreatePlane("TextPlane",n,e,!0);return i.material=new f.StandardMaterial("TextPlaneMaterial",e),i.material.backFaceCulling=!1,i.material.specularColor=new f.Color3(0,0,0),i.material.diffuseTexture=r,i}var X=function(e){var t=Object(s.a)({},e.dest);Object.keys(t).forEach((function(a){return t[a]=e.mesh[a]-e.dest[a]})),Object.keys(t).forEach((function(e){return 0!==t[e]?t[e]:delete t[e]}));var a,n,r,i=Object.values(e.normal),o=Object(O.a)(i,3),c=o[0],l=o[1],u=o[2],d=[c,l,u].findIndex((function(e){return Math.abs(e)})),h=[c,l,u][d];if(!e.normal||![c,l,u].some((function(e){return e})))return console.warn("no normals detected"),null;var m,f=Object.values(e.mesh),v=Object(O.a)(f,3),p=v[0],y=v[1],g=v[2],b=["x","y","z"][Math.abs(d)],w=Object.keys(t)[0],E=Object.values(t)[0];switch(n=Math.min(Math.abs(E),3),b){case"x":a="z"===w?"y":"z",m=h>0?-1:1,"y"===w&&(r=g,m*=E>0?1:-1),"z"===w&&(r=y,m*=E>0?-1:1),n*=m;break;case"y":a="z"===w?"x":"z",m=h>0?1:-1,"x"===w&&(r=g,m*=E>0?1:-1),"z"===w&&(r=p,m*=E>0?-1:1),n*=m;break;case"z":default:a="y"===w?"x":"y",m=h>0?1:-1,"y"===w&&(r=p,m*=E>0?1:-1),"x"===w&&(r=y,m*=E>0?-1:1),n*=m}return{rotation:a,amount:n,extent:r}};var Z,$,q=!1,_=[0,0],Q=f.PointerEventTypes.POINTERTAP,ee=f.PointerEventTypes.POINTERPICK,te=f.PointerEventTypes.POINTERDOWN,ae=f.PointerEventTypes.POINTERUP,ne=f.PointerEventTypes.POINTERMOVE,re=f.PointerEventTypes.POINTERDOUBLETAP,ie=function(e){var t,a=this.camera,n=this.canvas,r=e.type,i=e.pickInfo,o=void 0===i?null:i,c=(o||{}).pickedMesh,l=void 0===c?null:c,u=e.event,d=u.movementX,h=u.movementY;switch(r){case te:console.log(l,o),l&&l.id&&/^m/.test(l.id)&&l&&o&&(a.detachControl(n),q=!0,$={mesh:Object(s.a)({},l.absolutePosition),normal:Object(s.a)({},o.getNormal())});break;case ae:l&&Z&&($.dest=l.absolutePosition,t=X($),this.rotate(t)),a.attachControl(n,!0),Z=null,_=[0,0],$=null,q=!1;break;case ne:q&&(_[0]+=d,_[1]+=h,Z=Math.abs(_[0]+Math.abs(_[1]))>10);break;case ee:case Q:break;case re:if(console.log("double click - auto occupy",r),!/^m/.test(l.id))return;this.occupy(l.id);break;default:console.log("dropthrough",r)}};var oe=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"y",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:100;if(!r||!/^[xyz]$/.test(a))return;var o=r>0?1:-1,c=[.5,1,1.5,2][(Math.abs(r)-1)%4],l=.3*i>>0,u=function(e){var t=new f.Vector3(0,0,0),a=f.MeshBuilder.CreateSphere("pivot",{diameter:1,segments:2},e),n=new f.StandardMaterial("origin",e);return n.wireframe=!0,a.material=n,a.visibility=!1,a.position=t,a}(e),d=t.filter((function(e){var t=e[a]===n;return t&&e.mesh.setParent(u),t})),h=new f.Animation("spin","rotation.".concat(a),25,f.Animation.ANIMATIONTYPE_FLOAT,f.Animation.ANIMATIONLOOPMODE_CONSTANT),m=new f.BezierCurveEase(.09,.46,.51,1.09),v=[{frame:0,value:0},{frame:l,value:Math.PI*c*o}];h.setEasingFunction(m),h.setKeys(v),e.beginDirectAnimation(u,[h],0,l,!1,1,(function(){d=function(e,t){var a=e.map((function(e){var t=e.mesh.absolutePosition,a=t.x,n=t.y,r=t.z,i=e.mesh;a=Math.round(2*t.x)/2,n=Math.round(2*t.y)/2,r=Math.round(2*t.z)/2,i.parent=null,i.setAbsolutePosition(new f.Vector3(a,n,r));var o=i.getVerticesData(f.VertexBuffer.PositionKind),c=i.getVerticesData(f.VertexBuffer.NormalKind);return f.VertexData.ComputeNormals(o,i.getIndices(),c),i.setVerticesData(f.VertexBuffer.NormalKind,c),Object(s.a)({},e,{mesh:i,x:a,y:n,z:r})}));return a.forEach((function(e){t[e.id]=Object(s.a)({},e)})),a}(d,t),u.dispose(!0)}))};function se(e){return e&&e.owner?e.owner:""}function ce(e,t,a,n,r,i){return e.map((function(e){return he(n,t,e).reduce((function(e,t){return(r.test(se(a[t]))?1:0)+e}),0)}))}var le=function(e,t){var a;t=String(t);var n=de(e),r=function(e){var t=de(e),a={x:[[],[]],y:[[],[]],z:[[],[]]};return Object(p.a)(e).forEach((function(e){var n=e.x,r=e.y,i=e.z;Math.abs(n)===t&&a.x[n<0?0:1].push(e),Math.abs(r)===t&&a.y[r<0?0:1].push(e),Math.abs(i)===t&&a.z[i<0?0:1].push(e)})),a}(e),i=r.x,o=r.y,s=r.z,c=new RegExp("".concat(t),"i"),l=n+2,u=Object(p.a)(Array(l)).map((function(e,t){return t})),d=[i,o,s].map((function(e){return e.map((function(e){var t=ce(u,"row",e,n,c),a=ce(u,"col",e,n,c),r=function(e,t,a,n){return["backslash","forwardslash"].map((function(r){return he(n,r).reduce((function(a,n){return(e.test(se(t[n]))?1:0)+a}),0)===a?a:0}))}(c,e,l,n);return[].concat(Object(p.a)(t),Object(p.a)(a),Object(p.a)(r))}))})),h=(a=[]).concat.apply(a,Object(p.a)(d)),m=e.filter((function(e){return c.test(e.owner)})).map((function(){return 1})).length,f=e.filter((function(e){return e.type&&!e.owner})).length,v=h.map((function(e){return e.filter((function(e){return e===l?1:0}))})).map((function(e){return e.length})).reduce((function(e,t){return e+t}),0),y=h.map((function(e){return e.every((function(e){return e>=l}))})).filter((function(e){return e})).length,g={finished:0===f||y>0,remainder:f,dominance:y,sets:v,subtotal:m,total:(m+v*l)*(y?2:1)},b=function(e,t){ue[e]=ue[e]||{playerId:e};var a,n=ue[e],r=n.accumulated,i=void 0===r?0:r,o=n.current;return a=t.total,i+=a,ue[e]={playerId:e,accumulated:i,current:a},Object.values(ue).sort((function(e,t){return t.accumulated-e.accumulated}))}(t,g);return g.leader=b[0],g.rank=b,g};var ue={};function de(e){var t=Math.max.apply(null,e.map((function(e){return e.x})));return Math.round(t)}function he(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=e+2,o=Math.pow(i,2),s=function(e){return!0===r?null:-e},c=Object(p.a)(Array(o)).map((function(e,t){return t}));switch(a=String(a).toLowerCase()){case"0":case"col":case"column":case"vertical":t=function(e){return e%o%i===n?e:s(e)};break;case"1":case"row":case"horizontal":t=function(e){return e/i>>0===n?e:s(e)};break;case"2":case"descend":case"diagbck":case"backslash":n=0,t=function(e){return e%(i+1)===n?e:s(e)};break;case"3":case"ascend":case"diagfwd":case"forwardslash":n=i,t=function(e){return e%o%i+1+(e/i>>0)===n?e:s(e)};break;default:return null}return c.map(t).filter((function(e){return null!==e}))}var me=function(e,t){var a=e.scene,n=e.earth,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.18,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:750,o={};t.rank.forEach((function(e,t){return o[e.playerId]=Object(s.a)({},e,{rank:t})}));var c=t.rank[0].playerId;n.filter((function(e){return e.owner||e.owner===c})).map((function(e){return e.mesh.displace=o[e.owner].rank,e.mesh})).forEach((function(e){var t=e.absolutePosition,n=t.x,o=t.y,s=t.z,c=e.displace;c&&function(e,t,a,n,r){for(var i=g()(.25,5,0,1),o=Object(O.a)(a,3),s=o[0],c=o[1],l=o[2],u=r/50>>0,d=50*u,h=new f.Vector3(s,c,l),m=function(){var e=0;return function(t,a){var n=0;return n=a>=e?n=a*t:t*(t*e*(a-e)),e=a,n}}(),v=!1,p=function(a){var r=i(a/d),o=m(n,r);if(setTimeout((function(){return t.translate(h,o,f.Space.WORLD)}),a),a>=d&&!v){v=!0;var s=360*fe(5,.1),c=[fe(2,-2),fe(2,-2),fe(2,-2)],l=c[0],u=c[1],p=c[2];!function(e,t){e.registerBeforeRender(t)}(e,(function(){t.rotate(new f.Vector3(l,u,p),Math.PI/s,f.Space.LOCAL)}))}},y=0;y<=d;y+=u)p(y)}(a,e,[n,o,s],c*r,i)}))};function fe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=Math.random()*e+t;return a?n:n>>0}var ve=function(e){return function(e){var t,a,n,r=f.MeshBuilder.CreateIcoSphere("sphere",{radius:10,segments:128},e);t=a=n=.1050999;var i=new f.StandardMaterial("Material",e);i.pointsCloud=!0,i.pointSize=10,i.diffuseColor=new f.Color3(t,a,n),i.emissiveColor=new f.Color3(t,a,n),r.material=i}(e)};var pe=function(e){var t=e.engine,a=e.camera,n=e.scene;return void 0;n.meshes.filter((function(e){return e.isCore})).forEach((function(e){return function(e,t,a,n){console.log(e);var r=new f.VolumetricLightScatteringPostProcess("godrays",1,a,e,100,f.Texture.BILINEAR_SAMPLINGMODE,t,!1);r.useDiffuseColor=!0,r.mesh.position=new f.Vector3(0,0,0),new f.PointLight("Omni",new f.Vector3(0,0,0),n).position=r.mesh.position}(e,t,a,n)}))};var ye=function(e){return{save:ge.bind(e),load:be.bind(e)}};function ge(e){var t,a=this.state,n=this.earth,r={state:a,matrix:(t=[]).concat.apply(t,Object(p.a)(n)).map((function(e){var t=Object(s.a)({},e);return delete t.mesh,t}))};localStorage[e]=JSON.stringify(r,null,4)}function be(e){var t=this;"string"===typeof e&&(e=localStorage[e]||e,e=JSON.parse(e));var a=this.occupy.bind(this),n=e,r=n.state,i=n.matrix;this.state=Object(s.a)({},r);var o={};this.state.players.forEach((function(e){return o[e.playerId]=e})),(i=i.filter((function(e){return e.owner}))).forEach((function(e){var n=e.id,r=e.owner;t.earth[n]=Object(s.a)({},t.earth[n],{},e),a.call(t,"m".concat(n),o[r])}),this),console.log(this.state),this.generateScene(),this.setState({ts:(new Date).valueOf()})}var we=function(e){var t=["x","y","z"][b(2,0,!1)],a=Math.round(2*(b(2*e,0)-e))/2,n=[-1,1][b(1,0,!1)];return{rotation:t,extent:a,amount:n}};var Ee=function(e){var t=e.player,a=e.current,r=t.alias,i=t.material,o=t.twist,s={background:i},c="ui-player ".concat(a?"ui-player-current":""),l=n.createElement("div",{className:"ui-player-info"},r," (",o,")");return n.createElement("div",{className:c},n.createElement("div",{className:"ui-player-icon",style:s},l))};var Oe=["Agent Smith","Alex Delarge","Amon Goeth","Annie Wilkes","Anton Chigurh","Bane","Bellatrix Lestrange","Biff Tannen","Boba Fett","Buffalo Bill","Captain Hook","Chucky","Commodus","Count Dooku","Count Dracula","Cruella de Vil","Darth Maul","Darth Vader","Davy Jones","Doctor Octopus","Dolores Umbridge","Dracula","Dr. Evil","Frankenstien","Freddy Krueger","Ghostface","Gollum","HAL 9000","Hades","Hannibal Lecter","Hans Gruber","Hans Landa","Harvey Dent","Jabba the Hutt","Jack Torrance","Jafar","Jason Voorhees","Jigsaw","John Doe","Joker","Keyser S\xf6ze","Khan","Leatherface","Loki","Lord Voldemort","Magneto","Maleficent","Michael Corleone","Michael Myers","Nosferatu","Norman Bates","Nurse Ratched","Palpatine","Patrick Bateman","Pennywise","Pinhead","President Snow","Professor Moriarty","Ra's al Ghul","Saruman","Sauron","Scar","Scarecrow","T-1000","Terminator","Thanos","The Penguin","Tommy DeVito","Tyler Durden","Ultron","Vito Corleone","Xenomorph","Yautja"],xe=0,Ce=[],Ne=["black","white","red","grey"],ke=function(e,t){var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"x",t=36*Math.random()>>0;return[e,((E+=1)%36).toString(36),t.toString(36),Number((new Date).valueOf()).toString(36)].join("")}("p"),n=function(){var e=Ne.length,t=Ne[xe%e];return xe+=1,t}(),r=t?0:1,i=e||Me();return{material:n,playerId:a,twist:0,alias:i,spiecies:r}};function Me(){var e=Oe.length/4>>0,t=Oe.filter((function(e){return!(Ce.indexOf(e)+1)})),a=t[b(t.length-1,0,!1)];return Ce.push(a),Ce=Ce.slice(-e),a}Me();var je=function(e){function t(e){var a,n=e.state;e.saveSettings;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this))).handleSave=function(){var e=a.state,t=e.radius,n=e.players,r=e.opponents,i={radius:t,players:n.slice(0,r)};a.props.saveSettings(i)},a.handleNons=function(e){var t=Number(e.target.value),n=a.state.max;t=Math.min(t,n);var r=a.state,i=r.players,o=r.opponents;i=i.map((function(e,a){var n=o>t&&o-t-a>0?0:1;return e.spiecies=n,e})),a.setState({nonhuman:t,players:i})},a.handleRadius=function(e){var t=Number(e.target.value);a.setState({radius:t})},a.handleRadiusChange=function(e){var t=Number(e.target.value);a.props.updateEarth(t)},a.handlePlayers=function(e){var t=a.state.nonhuman,n=Number(e.target.value);t>n&&(t=n),a.setState({opponents:n,max:n,nonhuman:t})},a.updatePlayername=function(e,t){var n=a.state.players;n[e].alias=t,a.setState({players:n})},console.log(">>>>",n),a.state={radius:1,opponents:2,nonhuman:1,max:null,players:null},a.state.max=a.state.opponents,a.state.players=[0,1,2,3].map((function(e){var t=a.state.opponents>a.state.nonhuman&&a.state.opponents-a.state.nonhuman-e>0?0:1;return ke(null,0===t)})),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;if(!this.props.state.showSettings)return null;var t=this.state.radius,a="".concat(t+2,"x").concat(t+2),r=this.state.players.map((function(t,a){var r=e.state.opponents,i=t.alias,o=t.playerId,s=t.spiecies,c=t.material;return a+1>r?null:n.createElement(Se,{key:a,playerId:o,material:c,handler:function(t){return e.updatePlayername(a,t)},alias:i,spiecies:s})}),this);return n.createElement("div",{className:"ui"},n.createElement("div",{className:"ui-settings"},n.createElement("h2",null,"Game settings"),n.createElement(Pe,{key:"radius",min:"1",max:"4",label:"Matrix size",value:this.state.radius,text:a,handler:this.handleRadius,handleChange:this.handleRadiusChange}),n.createElement(Pe,{key:"opponents",min:"2",max:"4",label:"Opponents",value:this.state.opponents,handler:this.handlePlayers}),n.createElement(Pe,{key:"nonhuman",min:"0",max:this.state.max,label:"Non-human",value:this.state.nonhuman,handler:this.handleNons}),n.createElement("div",{className:"ui-players"},r),n.createElement("div",{className:"ui-cta-primary",onClick:this.handleSave},"PLAY")))}}]),t}(n.Component);function Pe(e){var t=e.value,a=e.text,r=void 0===a?null:a,i=e.label,o=void 0===i?null:i,s=e.min,c=e.max,l=e.handler,u=e.handleChange;return u=u||function(){},n.createElement("div",{className:"ui-settings-range"},n.createElement("div",{className:"ui-input-row"},n.createElement("span",{className:"ui-input-label"}," ",o||""),n.createElement("span",{className:"ui-input-text"}," ",r||t)),n.createElement("input",{className:"ui-input-range",type:"range",min:s,max:c,defaultValue:t,onInput:l,onChange:u}))}function Se(e){var t=e.alias,a=e.spiecies,r=e.material,i=e.handler;a=0===a?"human":"random";var o={background:r};return n.createElement("span",{className:"ui-player-card",style:o},n.createElement("div",{className:"ui-player-name"},n.createElement("textarea",{placeholder:"Your player name",type:"text",value:t,onChange:function(e){return i(e.target.value)}})),n.createElement("div",{className:"ui-player-spiecies"},a))}var Te=function(e){var t=e.finished,a=e.players,n=e.handleRestart;if(!t)return null;var i=function(e){var t=e.sort((function(e,t){return t.accumulated-e.accumulated})),a=t[0].accumulated,n=t.filter((function(e){return e.accumulated===a})).length;return console.log("winners",a,n),{count:n,rank:t}}(a),o=i.count,s=i.rank,c=s.map((function(e){var t=e.alias,a=e.accumulated,n=e.material,i=e.playerId;return r.a.createElement("div",{key:i,className:"ui-score-row"},r.a.createElement("span",{className:"ui-score-col ui-score-avatar"},n),r.a.createElement("span",{className:"ui-score-col ui-score-alias"},t),r.a.createElement("span",{className:"ui-score-col ui-score-points"},a))})),l=o>1,u=s[0].alias,d=l?"Nobody wins!":"".concat(u," wins!");return r.a.createElement("div",{className:"ui-status-game-over"},r.a.createElement("div",{className:"ui-game-over-stats"},r.a.createElement("div",{className:"ui-heading"},"Game Over"),r.a.createElement("div",{className:"ui-subheading"},d),c,r.a.createElement("div",{className:"ui-restart"},r.a.createElement("span",{className:"ui-cta-primary",onClick:n},"RESTART"))))};var De=function(e){var t=e.earth;if(!t)return null;var a=t.filter((function(e){return e.type})).map((function(e,t){var a={background:e.mesh.material.hexColor};return r.a.createElement("span",{className:"swatch",key:"hx"+t,style:a})}));return r.a.createElement("div",{className:"ui-terrain"},a)};var Ie=function(e){var t=e.state,a=e.array;if(!t.inProgress||t.finished)return null;var n=t.player,i=t.players[n],o=i.alias,s=i.twist,c=i.material;return r.a.createElement("div",{className:"ui-status-current-player"},r.a.createElement("div",{className:"ui-current"},r.a.createElement("div",{className:"ui-player-label"},r.a.createElement("div",{className:"ui-current-avatar",style:{background:c}}),r.a.createElement("div",{className:"ui-current-player"},o))),r.a.createElement("div",{className:"ui-status-icons"},r.a.createElement("div",{className:"ui-status-cell"},s," ",r.a.createElement("img",{className:"ui-icon",src:"/images/icons/twists.svg",alt:"twist"})),r.a.createElement("div",{className:"ui-status-cell"},i.accumulated||0," ",r.a.createElement("img",{className:"ui-icon",src:"/images/icons/score.svg",alt:"score"})),r.a.createElement("div",{className:"ui-status-cell"},a&&a.length," ",r.a.createElement("img",{className:"ui-icon",src:"/images/icons/square.svg",alt:"free squares"}))))};var Ve=function(e){return e.state.showIntro?n.createElement("div",{className:"ui-intro-instructions"},n.createElement("p",null,"Familiar lattice game in 3D"),n.createElement("h2",null,"How to play"),n.createElement("p",null,"double tap to occupy a cube"),n.createElement("p",null,"tap+drag on a cube to rotate accross a plane"),n.createElement("p",null,"tap+drag on the canvas to orbit the matrix"),n.createElement("h2",null,"Conditions of victory"),n.createElement("p",null,"Score is awarded by occupying a sequential set of territories"),n.createElement("p",null,"Each territory occupied gives you 2 opportunites to twist"),n.createElement("p",null,"Occupy and entire face will cause immediate victory")):null};var Ae=function(e){var t=e.state,a=e.earth,n=e.handleRestart,i=t.finished,o=t.players,s=a?a.filter((function(e){return!e.owner&&e.type})):null;return r.a.createElement("div",{className:"ui-status"},r.a.createElement(Ve,{state:t}),r.a.createElement(Ie,{state:t,array:s}),r.a.createElement(Te,{finished:i,players:o,handleRestart:n}),r.a.createElement(De,{state:t,earth:a}))};a(28);var ze=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(u.a)(this,Object(d.a)(t).call(this))).executeNonHumanPlayer=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(h.a)(e),r=n.earth,i=n.rotate,o=n.executeNonHumanPlayer,s=n.occupy,c=r.filter((function(e){return!e.owner&&e.type})),l=c[b(c.length-1,0,!1)],u=e.state,d=u.players,m=u.playDelay,f=u.radius,v=d[t],p=!!v.twist&&b(9,0,!1)%3===0,y=p?m+a:50;setTimeout((function(){if(p)return i(we(f)),void o(t,a+150);s(l.mesh.id)}),y)},e.rotate=function(t){var a=t.rotation,n=t.extent,r=t.amount,i=Object(h.a)(e),o=i.scene,s=i.earth,c=e.state,l=c.player,u=c.players,d=c.rotationFrames,m=u[l];if(m.twist){var f=Math.min(m.twist,Math.abs(r));oe(o,s,a,n,f=f*r>0?1:-1,d),m.twist-=1}},e.toggleToNextPlayer=function(){if(e.state.toggleOnDoubleTap){var t=e.state,a=t.player,n=t.players,r=t.playDelay,i=Object(h.a)(e).executeNonHumanPlayer,o=n[a=(a+1)%n.length],s=o.material;return console.log("%c%s","background: ".concat(s,"; color: #666; padding: 3px;"),o.alias,o.alias,o.spiecies),e.setState({player:a}),o.spiecies?setTimeout((function(){i(a)}),r):void 0}},e.occupy=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=e.state,r=n.player,i=n.players,o=n.finished,s=n.twistsPerPlay,c=n.showCubeCoords;if(o)alert("The game is over");else{var l=t.replace(/^m/i,""),u=e.earth[l];if(null===a&&u.owner)console.warn("already occupied",t,a);else{var d=N(Object(h.a)(e)),m=null===a?i[r]:a,v=m.material,p=m.playerId,y=u.x,g=u.y,b=u.z,w=u.axis,E=1.165;if(u.owner=m.playerId,c){var O=[y,g,b].join(","),x=w?"#":"";u.mesh.material=d(v,"".concat(t,"(").concat(O,")").concat(x))}if(u.mesh.material=d(v),u.mesh.scaling=new f.Vector3(E,E,E),console.log("Occupy",p,t,u),null===a){m.twist+=s;var C=e.updateScore();C.finished?me({scene:e.scene,earth:e.earth},C):e.toggleToNextPlayer()}}}},e.sceneDidMount=function(t){e.scene=t.scene,e.canvas=t.canvas,e.engine=t.engine;var a=e.state.radius;return e.camera=M(t,Object(h.a)(e)),e.earth=K(t,a),e.generateScene=Le.bind(Object(h.a)(e)),window.earth=e.earth,Le.call(Object(h.a)(e))},e.saveSettings=function(t){var a=t.radius,n=t.players,r=Object(s.a)({},e.state,{radius:a,players:n,finished:!1,inProgress:!0});e.setState(r,(function(){return e.saveAndStart(n,a)}))},e.updateEarth=function(t){console.log("re-generate earth matrix",t);var a=e.scene;e.earth=K({scene:a},t),window.earth=e.earth},e.state={showAxis:!1,showSettings:!0,playDelay:550,rotationFrames:50,focusOnOccupy:!0,twistsPerPlay:2,toggleOnDoubleTap:!0,showCubeCoords:!1,inProgress:!1,finished:!1,radius:1,player:0,players:null},e.state.players=[{material:"black",playerId:"111",twist:0,alias:"Jack Black",spiecies:1},{material:"white",playerId:"222",twist:0,alias:"Walter White",spiecies:1}],console.log("initial radius",e.state.radius),e.toggleToNextPlayer.bind(Object(h.a)(e)),e}return Object(m.a)(t,e),Object(l.a)(t,[{key:"getCurrentPlayer",value:function(){var e=this.state,t=e.player;return e.players[t]}},{key:"updateScore",value:function(){var e=this.earth,t=this.state,a=t.finished,n=t.players;if(!e||a)return null;var r=this.getCurrentPlayer().playerId,i=le(e,r);return i.rank.forEach((function(e){var t=n.findIndex((function(t){return t.playerId===e.playerId}));t<0?console.warn("can't find playerId",e.playerId):n[t].accumulated=e.accumulated})),a=!0===i.finished,this.setState({players:n,finished:a}),i}},{key:"getCurrentPlayerInfo",value:function(){var e=this.state,t=e.players,a=e.player;return t.map((function(e,t){return n.createElement(Ee,{key:t,player:e,current:t===a})}))}},{key:"render",value:function(){var e=this.earth,t=this.state;return n.createElement("div",{className:"ui-container"},n.createElement("div",{className:"ui-branding"},"FLIPTOPBOX"),n.createElement(Ae,{state:t,earth:e,handleRestart:this.restart.bind(this)}),n.createElement(je,{state:t,saveSettings:this.saveSettings,updateEarth:this.updateEarth}),n.createElement(v,{sceneDidMount:this.sceneDidMount,opts:{}}),";")}},{key:"restart",value:function(){console.log("Restart");var e=this.state,t=e.players,a=e.radius;t=t.map((function(e){return e.twist=0,e.accumulated=0,e})),this.updateEarth(a),this.setState({showSettings:!0,showIntro:!1,inProgress:!1,finished:!1,players:t})}},{key:"saveAndStart",value:function(e,t){var a=this,n=Object(s.a)({},this.setState,{showSettings:!1,showIntro:!1,inProgress:!0,radius:t,players:e});this.setState(n,(function(){window.camera.start(1200),e.reduce((function(e,t){return e+(0===t.spiecies?1:0)}),0)||a.executeNonHumanPlayer(0)}))}}]),t}(n.Component);function Le(){var e=this.scene,t=this.engine,a=this.camera,n=this.earth,r=this.state,i=r.radius,o=r.showAxis;t.runRenderLoop((function(){return e&&e.render()})),Y(3*(i+1),e,o),S({scene:e},"hemi","sun",.25,[.6,.7,.7],[.5,.5,.5]),S({scene:e},"point","point1",.4,[0,6,-1]),S({scene:e},"point","core1",1.4,[0,0,0]),e.clearColor=new f.Color3(.1,.1,.1),e.onPointerObservable.add(ie.bind(this)),this.setState({ready:!0}),ve(e),pe({scene:e,engine:t,camera:a,earth:n}),window.gameState=ye(this)}var Re=function(){return r.a.createElement(ze,null)};o.a.render(r.a.createElement(Re,null),document.getElementById("root"))}},[[18,1,2]]]);
//# sourceMappingURL=main.2a243117.chunk.js.map